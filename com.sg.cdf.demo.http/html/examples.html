<!DOCTYPE HTML>
<!-- saved from url=(0061)http://commons.apache.org/proper/commons-email/userguide.html -->
<!DOCTYPE html PUBLIC "" ""><!--
 | Generated by Apache Maven Doxia at 21 February 2014
 | Rendered using Apache Maven Fluido Skin 1.3.0
--><HTML 
lang="en" lang="en" xml:lang="en" 
xmlns="http://www.w3.org/1999/xhtml"><HEAD><META content="IE=11.0000" 
http-equiv="X-UA-Compatible">
     
<META charset="UTF-8">     
<META name="viewport" content="width=device-width, initial-scale=1.0">     
<META name="author" content="Commons Documentation Team">     
<META name="author" content="Quinton McCombs">     
<META name="Date-Revision-yyyymmdd" content="20140221">     
<META http-equiv="Content-Language" content="en">     <TITLE>Commons Email -     
Examples</TITLE>	 <LINK href="bootstrap.min.css" 
rel="stylesheet" type="text/css">	 <LINK href="site.css" 
rel="stylesheet" type="text/css">     <LINK href="print.css" 
rel="stylesheet" media="print">	 
<SCRIPT src="jquery.min.js" type="text/javascript"></SCRIPT>
	 
<SCRIPT src="bootstrap.min.js" type="text/javascript"></SCRIPT>
	 
<SCRIPT src="prettify.min.js" type="text/javascript"></SCRIPT>
	 
<SCRIPT src="site.js" type="text/javascript"></SCRIPT>
                             <LINK href="prettify.css" 
rel="stylesheet" type="text/css" media="all">                                
<SCRIPT src="prettify.js" type="text/javascript"></SCRIPT>
                                
<SCRIPT type="text/javascript">window.onload=function() {
              prettyPrint();
          }</SCRIPT>
                        
<META name="GENERATOR" content="MSHTML 11.00.9600.17126"></HEAD>	 
<BODY class="composite"><A title="Apache Commons logo" id="bannerLeft" href="http://commons.apache.org/"><IMG 
class="logo-left" alt="Apache Commons logo" src="commons-logo.png"> 
                </A>                                               <A id="bannerRight" 
href="http://commons.apache.org/proper/commons-email/index.html"><IMG class="logo-right" 
alt="Commons Email" src="email-logo-white.png"> 
                </A>      		 
<DIV class="clear"></DIV>
<DIV class="navbar">
<DIV class="navbar-inner">
<DIV class="container-fluid"><A class="brand" href="http://commons.apache.org/proper/commons-email/">Apache 
Commons Email ™</A>
<UL class="nav">
  <LI id="publishDate">Last Published: 21 February 2014</LI>
  <LI class="divider">|</LI>
  <LI id="projectVersion">Version: 1.4.0-SNAPSHOT</LI></UL>
<DIV class="pull-right">
<UL class="nav">
  <LI><A title="ApacheCon" class="externalLink" 
  href="http://www.apachecon.com/">    ApacheCon</A></LI>
  <LI><A title="Apache" class="externalLink" href="http://www.apache.org/">    
  Apache</A></LI>
  <LI><A title="Commons" href="http://commons.apache.org/">    
Commons</A></LI></UL></DIV></DIV></DIV></DIV>
<DIV class="container-fluid">
<TABLE class="layout-table">
  <TBODY>
  <TR>
    <TD class="sidebar">
      <DIV class="well sidebar-nav">
      <UL class="nav nav-list">
        <LI class="nav-header">Email</LI>
        <LI class="none"><A title="Overview" href="http://commons.apache.org/proper/commons-email/index.html"> 
           Overview</A></LI>
        <LI class="none"><A title="Download" href="http://commons.apache.org/email/download_email.cgi"> 
           Download</A></LI>
        <LI class="none active"><A title="User guide" href="http://commons.apache.org/proper/commons-email/userguide.html"> 
           User guide</A></LI>
        <LI class="none"><A title="Latest API docs (development)" href="http://commons.apache.org/proper/commons-email/apidocs/index.html"> 
           Latest API docs (development)</A></LI>
        <LI class="none"><A title="Javadoc (1.3.2 release)" href="http://commons.apache.org/proper/commons-email/javadocs/api-release/index.html"> 
           Javadoc (1.3.2 release)</A></LI>
        <LI class="none"><A title="Javadoc (1.2 release)" href="http://commons.apache.org/proper/commons-email/javadocs/api-1.2/index.html"> 
           Javadoc (1.2 release)</A></LI></UL>
      <UL class="nav nav-list">
        <LI class="nav-header"><I class="icon-cog"></I>Development</LI>
        <LI class="none"><A title="Building" href="http://commons.apache.org/proper/commons-email/building.html"> 
           Building</A></LI></UL>
      <UL class="nav nav-list">
        <LI class="nav-header"><I class="icon-info-sign"></I>Project 
        Documentation</LI>
        <LI class="collapsed"><A title="Project Information" href="http://commons.apache.org/proper/commons-email/project-info.html"> 
           Project Information</A></LI>
        <LI class="collapsed"><A title="Project Reports" href="http://commons.apache.org/proper/commons-email/project-reports.html"> 
           Project Reports</A></LI></UL>
      <UL class="nav nav-list">
        <LI class="nav-header">Commons</LI>
        <LI class="none"><A title="Home" href="http://commons.apache.org/">    
        Home</A></LI>
        <LI class="none"><A title="License" class="externalLink" href="http://www.apache.org/licenses/"> 
           License</A></LI>
        <LI class="collapsed"><A title="Components" href="http://commons.apache.org/components.html"> 
           Components</A></LI>
        <LI class="collapsed"><A title="Sandbox" href="http://commons.apache.org/sandbox/index.html"> 
           Sandbox</A></LI>
        <LI class="collapsed"><A title="Dormant" href="http://commons.apache.org/dormant/index.html"> 
           Dormant</A></LI></UL>
      <UL class="nav nav-list">
        <LI class="nav-header">General Information</LI>
        <LI class="none"><A title="Volunteering" href="http://commons.apache.org/volunteering.html"> 
           Volunteering</A></LI>
        <LI class="none"><A title="Contributing Patches" href="http://commons.apache.org/patches.html"> 
           Contributing Patches</A></LI>
        <LI class="none"><A title="Building Components" href="http://commons.apache.org/building.html"> 
           Building Components</A></LI>
        <LI class="none"><A title="Releasing Components" href="http://commons.apache.org/releases/index.html"> 
           Releasing Components</A></LI>
        <LI class="none"><A title="Wiki" class="externalLink" href="http://wiki.apache.org/commons/FrontPage"> 
           Wiki</A></LI></UL>
      <UL class="nav nav-list">
        <LI class="nav-header">ASF</LI>
        <LI class="none"><A title="How the ASF works" class="externalLink" href="http://www.apache.org/foundation/how-it-works.html"> 
           How the ASF works</A></LI>
        <LI class="none"><A title="Get Involved" class="externalLink" href="http://www.apache.org/foundation/getinvolved.html"> 
           Get Involved</A></LI>
        <LI class="none"><A title="Developer Resources" class="externalLink" 
        href="http://www.apache.org/dev/">    Developer Resources</A></LI>
        <LI class="none"><A title="Sponsorship" class="externalLink" href="http://www.apache.org/foundation/sponsorship.html"> 
           Sponsorship</A></LI>
        <LI class="none"><A title="Thanks" class="externalLink" href="http://www.apache.org/foundation/thanks.html"> 
           Thanks</A></LI></UL></DIV>
      <DIV id="poweredBy"><A title="ApacheCon" class="builtBy" href="http://www.apache.org/events/current-event.html"><IMG 
      class="builtBy" alt="ApacheCon" src="current-event-125x125.png"></A><A 
      title="Maven" class="builtBy" href="http://maven.apache.org/"><IMG class="builtBy" 
      alt="Maven" 
      src="maven-feather.png"></A></DIV></TD>
    <TD class="content"><!-- Licensed to the Apache Software Foundation (ASF) under one or more
 contributor license agreements.  See the NOTICE file distributed with
 this work for additional information regarding copyright ownership.
 The ASF licenses this file to You under the Apache License, Version 2.0
 (the "License"); you may not use this file except in compliance with
 the License.  You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. --> 
            
      <DIV class="section">
      <H2>A simple text email<A name="A_simple_text_email"></A></H2>
      <P>        Our first example will create a basic email message to "John 
      Doe" and        send it through your Google Mail (GMail)  account.       
      </P>
      <DIV class="source">
<PRE>
Email email = new SimpleEmail();
email.setHostName("smtp.googlemail.com");
email.setSmtpPort(465);
email.setAuthenticator(new DefaultAuthenticator("username", "password"));
email.setSSLOnConnect(true);
email.setFrom("user@gmail.com");
email.setSubject("TestMail");
email.setMsg("This is a test mail ... :-)");
email.addTo("foo@bar.com");
email.send();
</PRE></DIV>
      <P>        The call to setHostName("mail.myserver.com") sets the address 
      of the        outgoing SMTP server that will be used to send the message.  
      If this is        not set, the system property "mail.host" will be used.   
          </P></DIV>
      <DIV class="section">
      <H2>Sending emails with attachments<A name="Sending_emails_with_attachments"></A></H2>
      <P>        To add attachments to an email, you will need to use the 
      MultiPartEmail        class.  This class works just like SimpleEmail 
      except that it adds        several overloaded attach() methods to add 
      attachments to the email.        You can add an unlimited number of 
      attachments either inline or        attached.  The attachments will be 
      MIME encoded.       </P>
      <P>        The simplest way to add the attachments is by using the 
      EmailAttachment        class to reference your attachments.       </P>
      <P>        In the following example, we will create an attachment for a 
      picture.        We will then attach the picture to the email and send it.  
           </P>
      <DIV class="source">
<PRE>
import org.apache.commons.mail.*;
...

  // Create the attachment
  EmailAttachment attachment = new EmailAttachment();
  attachment.setPath("mypictures/john.jpg");
  attachment.setDisposition(EmailAttachment.ATTACHMENT);
  attachment.setDescription("Picture of John");
  attachment.setName("John");

  // Create the email message
  MultiPartEmail email = new MultiPartEmail();
  email.setHostName("mail.myserver.com");
  email.addTo("jdoe@somewhere.org", "John Doe");
  email.setFrom("me@apache.org", "Me");
  email.setSubject("The picture");
  email.setMsg("Here is the picture you wanted");

  // add the attachment
  email.attach(attachment);

  // send the email
  email.send();
</PRE></DIV>
      <P>        You can also use EmailAttachment to reference any valid URL for 
      files        that you do not have locally.  When the message is sent, the 
      file will        be downloaded and attached to the message automatically.  
           </P>
      <P>        The next example shows how we could have sent the apache logo   
           to John instead.       </P>
      <DIV class="source">
<PRE>
import org.apache.commons.mail.*;
...

  // Create the attachment
  EmailAttachment attachment = new EmailAttachment();
  attachment.setURL(new URL("http://www.apache.org/images/asf_logo_wide.gif"));
  attachment.setDisposition(EmailAttachment.ATTACHMENT);
  attachment.setDescription("Apache logo");
  attachment.setName("Apache logo");

  // Create the email message
  MultiPartEmail email = new MultiPartEmail();
  email.setHostName("mail.myserver.com");
  email.addTo("jdoe@somewhere.org", "John Doe");
  email.setFrom("me@apache.org", "Me");
  email.setSubject("The logo");
  email.setMsg("Here is Apache's logo");
  
  // add the attachment
  email.attach(attachment);

  // send the email
  email.send();
</PRE></DIV></DIV>
      <DIV class="section">
      <H2>Sending HTML formatted email<A 
      name="Sending_HTML_formatted_email"></A></H2>
      <P>        Sending HTML formatted email is accomplished by using the 
      HtmlEmail        class.  This class works exactly like the MultiPartEmail 
      class with        additional methods to set the html content, alternative 
      text content        if the recipient does not support HTML email, and add 
      inline images.       </P>
      <P>        In this example, we will send an email message with formatted 
      HTML        content with an inline image.       </P>
      <DIV class="source">
<PRE>
import org.apache.commons.mail.HtmlEmail;
...

  // Create the email message
  HtmlEmail email = new HtmlEmail();
  email.setHostName("mail.myserver.com");
  email.addTo("jdoe@somewhere.org", "John Doe");
  email.setFrom("me@apache.org", "Me");
  email.setSubject("Test email with inline image");
  
  // embed the image and get the content id
  URL url = new URL("http://www.apache.org/images/asf_logo_wide.gif");
  String cid = email.embed(url, "Apache logo");
  
  // set the html message
  email.setHtmlMsg("&lt;html&gt;The apache logo - &lt;img src=\"cid:"+cid+"\"&gt;&lt;/html&gt;");

  // set the alternative message
  email.setTextMsg("Your email client does not support HTML messages");

  // send the email
  email.send();
</PRE></DIV>
      <P>        First, notice that the call to embed() returns a String.  This 
      String        is a randomly generated identifier that must be used to 
      reference        the image in the image tag.       </P>
      <P>        Next, there was no call to setMsg() in this example.  The 
      method is        still available in HtmlEmail but it should not be used if 
      you will be        using inline images.  Instead, the setHtmlMsg() and 
      setTextMsg()        methods were used.       </P></DIV>
      <DIV class="section">
      <H2>Sending HTML formatted email with embedded images<A name="Sending_HTML_formatted_email_with_embedded_images"></A></H2>
      <P>        The previous example showed how to create a HTML email with 
      embedded        images but you need to know all images upfront which is 
      inconvenient        when using a HTML email template. The ImageHtmlEmail 
      helps you        solving this problem by converting all external images to 
      inline        images.       </P>
      <DIV class="source">
<PRE>        
import org.apache.commons.mail.HtmlEmail;
...

  // load your HTML email template
  String htmlEmailTemplate = ....

  // define you base URL to resolve relative resource locations
  URL url = new URL("http://www.apache.org");

  // create the email message
  HtmlEmail email = new ImageHtmlEmail();
  email.setDataSourceResolver(new DataSourceResolverImpl(url));
  email.setHostName("mail.myserver.com");
  email.addTo("jdoe@somewhere.org", "John Doe");
  email.setFrom("me@apache.org", "Me");
  email.setSubject("Test email with inline image");
  
  // set the html message
  email.setHtmlMsg(htmlEmailTemplate);

  // set the alternative message
  email.setTextMsg("Your email client does not support HTML messages");

  // send the email
  email.send();
  </PRE></DIV>
      <P>        First we create a HTML email template referencing some images. 
      All          referenced images are automatically transformed to inline 
      images        starting from the current working directory.         
      </P></DIV>
      <DIV class="section">
      <H2>Debugging<A name="Debugging"></A></H2>
      <P>        The JavaMail API supports a debugging option that will can be 
      very        useful if you run into problems.  You can activate debugging 
      on any        of the mail classes by calling setDebug(true).  The 
      debugging output        will be written to <TT>System.out</TT>.       </P>
      <P>        Sometimes you want to experiment with various security setting 
      or        features of commons-email. A good starting point is the test 
      class         <TT>EmailLiveTest</TT> and <TT>EmailConfiguration</TT> which 
             are used for testing commons-email with real SMTP servers.       
      </P></DIV>
      <DIV class="section">
      <H2>Authentication<A name="Authentication"></A></H2>
      <P>        If you need to authenticate to your SMTP server, you can call 
      the         <TT>setAuthentication(userName,password)</TT> method before 
      sending        your email.  This will create an instance of         
      <TT>DefaultAuthenticator</TT> which will be used by the JavaMail        
      API when the email is sent.  Your server must support RFC2554 in        
      order for this to work.       </P>
      <P>        You can perform a more complex authentication method such as 
      displaying        a dialog box to the user by creating a subclass of the   
            <TT>javax.mail.Authenticator</TT> object.  You will need to        
      override the <TT>getPasswordAuthentication()</TT> method where        you 
      will handle collecting the user's information.  To make use of        your 
      new <TT>Authenticator</TT> class, use the         
      <TT>Email.setAuthenticator</TT> method.       </P></DIV>
      <DIV class="section">
      <H2>Security<A name="Security"></A></H2>
      <P>        Nowadays you should not use plain SMTP protocol when using 
      public SMTP servers         but there is a some confusion regarding the 
      available options.       </P>
      <P>          Two commons options are using          </P>
      <UL>
        <LI>STARTTLS on port 25</LI>
        <LI>SSL on port 465</LI></UL>        The following definitions were taken 
      from Wikipedia         
      <UL>
        <LI>            STARTTLS is an extension to plain text communication 
        protocols, which offers a             way to upgrade a plain text 
        connection to an encrypted (TLS or SSL) connection             instead 
        of using a separate port for encrypted communication.           </LI>
        <LI>            Transport Layer Security (TLS) and its predecessor, 
        Secure Sockets Layer (SSL),             are cryptographic protocols that 
        provide communication security over the             Internet.TLS and SSL 
        encrypt the segments of network connections above the             
        Transport Layer, using asymmetric cryptography for key exchange, 
        symmetric             encryption for privacy, and message authentication 
        codes for message integrity.           </LI></UL>        In addition you 
      can force the following security checks (which are disabled by default)    
           
      <UL>
        <LI>            When using a secured transport (STARTTLS or SSL) you can 
        force validating the server's             certificate by calling 
        <TT>Email.setSSLCheckServerIdentity(true)</TT>.             </LI>
        <LI>            Enforce using STARTTLS by calling 
        <TT>Email.setStartTLSRequired(true)</TT>           </LI></UL></DIV>
      <DIV class="section">
      <H2>Handling Bounced Messages<A name="Handling_Bounced_Messages"></A></H2>
      <P>        Normally, messages which cannot be delivered to a recipient are 
      returned to the        sender (specified with the <TT>from</TT> property). 
       However, in some cases,        you'll want these to be sent to a 
      different address.  To do this, simply call the         
      <TT>setBounceAddress(emailAddressString)</TT> method before sending        
      your email.       </P>
      <P>        Technical notes: When SMTP servers cannot deliver mail, they do 
      not pay any attention        to the contents of the message to determine 
      where the error notification should be        sent.  Rather, they refer to 
      the SMTP "envelope sender" value.  JavaMail sets this        value 
      according to the value of the <TT>mail.smtp.from</TT> property on the      
        JavaMail <TT>Session</TT>.  (Commons Email initializes the JavaMail      
         <TT>Session</TT> using <TT>System.getProperties()</TT>)        If this 
      property has not been set, then JavaMail        uses the "from" address.  
      If your email bean has the <TT>bounceAddress</TT>        property set, 
      then Commons Email uses it to set the value of <TT>mail.smtp.from</TT>     
         when the <TT>Session</TT> is initialized, overriding any other value    
          which might have been set.       </P>
      <P><I>Note: </I> This is the only way to control the handling of bounced 
      email.        Specifically, the "Errors-to:" SMTP header is deprecated and 
      cannot be trusted        to control how a bounced message will be handled. 
       Also note that it is considered bad        practice to send email with an 
      untrusted "from" address unless you also set the        bounce address.  
      If your application allows users to enter an address which is used        
      as the "from" address on an email, you should be sure to set the bounce 
      address        to a known good address.       
</P></DIV></TD></TR></TBODY></TABLE></DIV>
<DIV class="footer">
<P>Copyright ©                    2001-2014                         <A href="http://www.apache.org/">The 
Apache Software Foundation</A>.            All Rights Reserved.</P>
<DIV class="center">Apache Commons, Apache Commons Email, Apache, the Apache 
feather logo, and the Apache Commons project logos are trademarks of The Apache 
Software Foundation.      All other marks mentioned may be trademarks or 
registered trademarks of their respective owners.</DIV></DIV></BODY></HTML>
